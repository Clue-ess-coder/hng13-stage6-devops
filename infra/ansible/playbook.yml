---
- name: Deploy Microservices Application
  hosts: microservices
  become: yes
  gather_facts: yes

  pre_tasks:
    - name: Update apt cache
      apt:
        update_cache: yes
        cache_valid_time: 3600

    - name: Wait for system to be ready
      wait_for_connection:
        timeout: 300

  roles:
    - dependencies
    - deploy

  post_tasks:
    - name: Display deployment information
      debug:
        msg:
          - "Deployment completed successfully!"
          - "Application URL: https://{{ domain_name }}"
          - "Server IP: {{ ansible_host }}"
